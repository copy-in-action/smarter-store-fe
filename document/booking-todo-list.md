# ì˜ˆë§¤ í”„ë¡œì„¸ìŠ¤ TODO ë¦¬ìŠ¤íŠ¸

## ğŸ”´ ë¯¸í•´ê²° ì´ìŠˆ

### 1. ë‹¤ë¥¸ ì‚¬ëŒ ì ìœ  ì‹œ ì²˜ë¦¬
- **ë¬¸ì œ**: ë‹¤ë¥¸ ì‚¬ëŒì´ ì¢Œì„ì„ ì ìœ í•œ ê²½ìš° ì²˜ë¦¬ ë°©ë²•
- **í•´ê²° ë°©ì•ˆ**: ì ìœ  ì‹œ ë°”ë¡œ ì·¨ì†Œ ì²˜ë¦¬
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

### 2. ë’¤ë¡œê°€ê¸° ì‹œ ìŠ¤í† ë¦¬ì§€ ì œê±°
- **ë¬¸ì œ**: ë¸Œë¼ìš°ì € ë’¤ë¡œê°€ê¸° ì‹œ ìŠ¤í† ë¦¬ì§€ ì •ë¦¬ í•„ìš”
- **í•´ê²° ë°©ì•ˆ**: ë’¤ë¡œê°€ê¸° ì´ë²¤íŠ¸ ê°ì§€í•˜ì—¬ ìŠ¤í† ë¦¬ì§€ ì œê±°
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

### 3. ë¸Œë¼ìš°ì €/íƒ­ ë‹«ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬
- **ë¬¸ì œ**: ë¸Œë¼ìš°ì €/íƒ­ ë‹«ì„ ë•Œ ì˜ˆë§¤ ì·¨ì†Œ ì²˜ë¦¬ í•„ìš”
- **ì°¸ê³ **: ìœ íŠœë¸Œ ë®¤ì§ êµ¬í˜„ ë°©ì‹ í™•ì¸
- **í•´ê²° ë°©ì•ˆ**: `beforeunload` ì´ë²¤íŠ¸ í™œìš©
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

### 4. ì ìœ  ì‹œê°„ í™•ì¸ ë° ë°ì´í„° ì •í•©ì„±
- **ë¬¸ì œ**: ì ìœ  ì‹œê°„ ë³€ê²½ ìš”ì²­í–ˆìœ¼ë‚˜ ë‚¨ì€ì‹œê°„ ë°ì´í„°ê°€ ë³€ê²½ë˜ì§€ ì•ŠìŒ
- **í•´ê²° ë°©ì•ˆ**:
  - ì„œë²„ ì ìœ  ì‹œê°„ ì„¤ì • í™•ì¸
  - API ì‘ë‹µ ë°ì´í„° í™•ì¸
  - í”„ë¡ íŠ¸ì—”ë“œ íƒ€ì´ë¨¸ ë¡œì§ê³¼ ì„œë²„ ì‹œê°„ ë™ê¸°í™”
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

### 5. Step3 â†’ Step2 ì´ë™ ì‹œ 404 í˜ì´ì§€ ê¹œë¹¡ì„
- **ë¬¸ì œ**: ê²°ì œ í™”ë©´(Step3)ì—ì„œ ì¢Œì„ ì„ íƒ(Step2)ìœ¼ë¡œ ì´ë™ ì‹œ ì ê¹ 404 í˜ì´ì§€ ë³´ì„
- **í•´ê²° ë°©ì•ˆ**:
  - ë¼ìš°íŒ… ì „í™˜ íƒ€ì´ë° í™•ì¸
  - Suspense ë˜ëŠ” ë¡œë”© ìƒíƒœ ì¶”ê°€
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

### 6. SSE ì—°ê²° ì¢…ë£Œ ì¼€ì´ìŠ¤ ë° ì²˜ë¦¬
- **ë¬¸ì œ**: SSEê°€ ë‹«í ì¼€ì´ìŠ¤ê°€ ì–¸ì œì¸ì§€, ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ ë¶ˆëª…í™•
- **í•´ê²° ë°©ì•ˆ**:
  - SSE ì—°ê²° ì¢…ë£Œ ì¼€ì´ìŠ¤ ì •ì˜
    - ì˜ˆë§¤ ì™„ë£Œ
    - ì˜ˆë§¤ ì·¨ì†Œ
    - íƒ€ì„ì•„ì›ƒ
    - ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
  - ê° ì¼€ì´ìŠ¤ë³„ ì¬ì—°ê²° ë˜ëŠ” ì¢…ë£Œ ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

### 7. ëª¨ë°”ì¼ í™”ë©´ ëŒ€ì‘
- **ë¬¸ì œ**: ëª¨ë°”ì¼ í™”ë©´ ìµœì í™” í•„ìš”
- **í•´ê²° ë°©ì•ˆ**: ë°˜ì‘í˜• UI ê°œì„ 
- **ìƒíƒœ**: âŒ ë¯¸í•´ê²°

---

## âœ… í•´ê²° ì™„ë£Œ

### ~~8. ê²°ì œê°€ëŠ¥ì‹œê°„ ë§Œë£Œ ì‹œ 404 í™”ë©´ ì´ë™~~
- **ë¬¸ì œ**:
  - ê²°ì œ í™”ë©´ì—ì„œ ê²°ì œê°€ëŠ¥ì‹œê°„ì´ ë§Œë£Œë˜ë©´ 404 í™”ë©´ìœ¼ë¡œ ì´ë™ë¨
  - `BookingHeader`ì™€ `BookingPayment`ì—ì„œ ë™ì‹œì— í˜ì´ì§€ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¥¼ ì‹œë„í•˜ì—¬ ì¶©ëŒ ë°œìƒ

- **í•´ê²° ë°©ë²•**:
  1. **BookingHeaderì—ì„œ ê²°ì œ í˜ì´ì§€ ì²´í¬**:
     - Zustand hydration ì™„ë£Œ í›„ì—ë§Œ ì²´í¬í•˜ì—¬ false positive ë°©ì§€
     - `paymentData`ê°€ ì—†ìœ¼ë©´ í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
     ```typescript
     useEffect(() => {
       if (!isHydrated) return;
       if (pathname === PAGES.BOOKING.PAYMENT.path && !paymentData) {
         router.replace(PAGES.HOME.path);
       }
     }, [isHydrated, pathname, paymentData, router]);
     ```

  2. **BookingPaymentì—ì„œ early return ì²˜ë¦¬**:
     - `notFound()` ëŒ€ì‹  `null` ë°˜í™˜ìœ¼ë¡œ ë³€ê²½
     - ë¼ìš°íŒ… ì¶©ëŒ ë°©ì§€
     ```typescript
     if (!paymentInfo) {
       return null; // notFound() ëŒ€ì‹  ë Œë”ë§í•˜ì§€ ì•ŠìŒ
     }
     ```

  3. **íƒ€ì´ë¨¸ ë§Œë£Œ ì‹œ ì²˜ë¦¬**:
     - `handleTimerExpire`ì—ì„œ store ì´ˆê¸°í™” í›„ ê³µì—° ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
     - ì‚¬ìš©ì ì¹œí™”ì ì¸ ë§Œë£Œ ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ

- **ê´€ë ¨ íŒŒì¼**:
  - `src/widgets/booking-header/ui/BookingHeader.tsx`
  - `src/features/service/booking-payment/ui/BookingPayment.tsx`

- **ìƒíƒœ**: âœ… ì™„ë£Œ (2026-01-12)

---

### ~~ê²°ì œí™”ë©´ì—ì„œ íƒ€ì´ë¨¸ê°€ ë‹¤ì‹œ ê°±ì‹ ë¨, ìƒˆë¡œê³ ì¹¨ ì‹œì—ë„~~
- **ë¬¸ì œ**:
  - step ì´ë™ ì‹œ(step2 â†’ step3 â†’ step2) íƒ€ì´ë¨¸ê°€ ì´ˆê¸°ê°’ìœ¼ë¡œ ë¦¬ì…‹ë¨
  - ì˜ˆë§¤ ì‹œì‘ ì‹œ API ì‘ë‹µìœ¼ë¡œ ë°›ì€ ìµœì´ˆ ë‚¨ì€ ì‹œê°„(`remainingSeconds`)ì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ë Œë”ë§ìœ¼ë¡œ ì¸í•´ ë‹¤ì‹œ 5ë¶„ì—ì„œ íƒ€ì´ë¨¸ê°€ ì‹œì‘ë¨
  - React Query ìºì‹œì— ì˜¤ë˜ëœ ê°’ì´ ì €ì¥ë˜ì–´ ìˆì–´ step ë³µê·€ ì‹œ íƒ€ì´ë¨¸ê°€ ë¦¬ì…‹ë¨

- **í•´ê²° ë°©ë²•** (expiresAt ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½):
  1. **API ì‘ë‹µì˜ `expiresAt` í™œìš©**:
     - `remainingSeconds` ëŒ€ì‹  `expiresAt`(ISO 8601 ë§Œë£Œ ì‹œê°)ì„ storeì— ì €ì¥
     - React Query ìºì‹± ë¡œì§ ì™„ì „ ì œê±°
     ```typescript
     // start API í˜¸ì¶œ í›„
     setBookingData(response); // expiresAt í¬í•¨
     ```

  2. **BookingTimerë¥¼ expiresAt ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½**:
     - Propsë¥¼ `remainingSeconds` â†’ `expiresAt`ìœ¼ë¡œ ë³€ê²½
     - ë§¤ì´ˆ `expiresAt` ê¸°ì¤€ìœ¼ë¡œ ë‚¨ì€ ì‹œê°„ ì¬ê³„ì‚°
     ```typescript
     // BookingTimer.tsx
     const calculateRemainingSeconds = (expiresAt: string): number => {
       const expiresTime = new Date(expiresAt).getTime();
       const now = Date.now();
       const remainingMs = expiresTime - now;
       return Math.max(0, Math.floor(remainingMs / 1000));
     };

     const timer = setInterval(() => {
       const remaining = calculateRemainingSeconds(expiresAtRef.current);
       setTimeLeft(remaining);
     }, 1000);
     ```

  3. **BookingHeaderì—ì„œ expiresAt ì „ë‹¬**:
     ```typescript
     {bookingData?.expiresAt && (
       <BookingTimer
         expiresAt={bookingData.expiresAt}
         onExpire={handleTimerExpire}
       />
     )}
     ```

- **ê²°ê³¼**:
  - âœ… step ì´ë™ ì‹œ íƒ€ì´ë¨¸ ìœ ì§€ (expiresAt ê¸°ì¤€ì´ë¯€ë¡œ ë¦¬ë Œë”ë§ ë¬´ê´€)
  - âœ… ìƒˆë¡œê³ ì¹¨ ì‹œ ìë™ìœ¼ë¡œ ì„œë²„ ì‹œê°„ê³¼ ë™ê¸°í™” (expiresAt ê¸°ì¤€ ì¬ê³„ì‚°)
  - âœ… React Query ì˜ì¡´ì„± ì œê±° (ìºì‹œ ê´€ë¦¬ ë¶ˆí•„ìš”)
  - âœ… í´ë¼ì´ì–¸íŠ¸ íƒ€ì´ë¨¸ë¡œ ë¶€ë“œëŸ¬ìš´ ì¹´ìš´íŠ¸ë‹¤ìš´
  - âœ… bookingIdê°€ ë™ì¼í•˜ë©´ í•­ìƒ ì •í™•í•œ ì‹œê°„ í‘œì‹œ

- **ê´€ë ¨ íŒŒì¼**:
  - `src/features/service/booking-seating-chart/hooks/useBookingStepControl.ts`
  - `src/widgets/booking-header/ui/BookingHeader.tsx`
  - `src/widgets/booking-header/ui/BookingTimer.tsx`
  - `src/features/service/booking-process/index.ts`

- **ìƒíƒœ**: âœ… ì™„ë£Œ (2026-01-12)

---

## ğŸ“ ë©”ëª¨
- ì´ìŠˆ í•´ê²° ì‹œ í•´ë‹¹ í•­ëª©ì„ "âœ… í•´ê²° ì™„ë£Œ" ì„¹ì…˜ìœ¼ë¡œ ì´ë™
- ê° ì´ìŠˆ í•´ê²° ì‹œ ê´€ë ¨ íŒŒì¼ ê²½ë¡œ ë° ì»¤ë°‹ í•´ì‹œ ê¸°ë¡
